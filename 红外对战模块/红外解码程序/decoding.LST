C51 COMPILER V9.00   DECODING                                                              08/13/2014 15:34:07 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE DECODING
OBJECT MODULE PLACED IN decoding.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE decoding.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <reg51.h>
   2          #include <intrins.h>
   3          
   4          #define uchar unsigned char
   5          #define uint  unsigned int
   6          
   7          void delay(uchar x);      //x*0.14MS
   8          void delayms(int ms);
   9          
  10          sbit IRIN = P3^2;         //红外接收器数据线
  11          sbit LED1 = P3^4;
  12          sbit LED2 = P3^3;
  13          sbit LED3 = P3^1;
  14          sbit LED4 = P3^0;
  15          int IR_val;
  16          
  17          uchar receive_flag;
  18          
  19          uchar IRCOM[7];
  20          
  21          main()
  22          {
  23   1      //外部中断初始化
  24   1          INT0 = 1;
  25   1          IT0 = 1;                    //设置INT0的中断类型 (1:仅下降沿 0:上升沿和下降沿)
  26   1          EX0 = 1;                    //使能INT0中断
  27   1          EA = 1;
  28   1          
  29   1          IRIN=1;                    //I/O口初始化
  30   1          
  31   1          delayms(10);                //延时
  32   1          while(1)
  33   1          {
  34   2          if(receive_flag==1) {
  35   3          receive_flag=0;
  36   3          switch(IRCOM[3])
  37   3            {
  38   4              case 0x20:
  39   4                LED1=0;
  40   4                delayms(1000);
  41   4                LED1=1;
  42   4              break;
  43   4              case 0x30:
  44   4                LED2=0;
  45   4                delayms(1000);
  46   4                LED2=1;
  47   4              break;
  48   4              case 0x40:
  49   4                LED3=0;
  50   4              delayms(1000);
  51   4                LED3=1;
  52   4              case 0x50:
  53   4                LED4=1;
  54   4                delayms(1000);
  55   4                LED4=0;
C51 COMPILER V9.00   DECODING                                                              08/13/2014 15:34:07 PAGE 2   

  56   4              default:
  57   4                LED1=1;
  58   4                LED2=1;
  59   4              break;
  60   4            }
  61   3          }
  62   2          }
  63   1        
  64   1      } //end main
  65          /**********************************************************/
  66          void exint0() interrupt 0      //INT0中断入口
  67          {
  68   1        unsigned char j,k,N=0;
  69   1         EX0 = 0; 
  70   1         delay(15);
  71   1        
  72   1         if (IRIN==1)                         //确认IR信号出现
  73   1           { EX0 =1;
  74   2           return;
  75   2          }
  76   1      
  77   1        while (!IRIN)                        
  78   1        {delay(1);}                          //等IR变为高电平，跳过9ms的前导低电平信号。
  79   1          
  80   1      
  81   1       for (j=0;j<4;j++)         //收集四组数据
  82   1       { 
  83   2        for (k=0;k<8;k++)        //每组数据有8位
  84   2        {
  85   3         while (IRIN)            //等 IR 变为低电平，跳过4.5ms的前导高电平信号。
  86   3           {delay(1);}
  87   3          while (!IRIN)          //等 IR 变为高电平
  88   3           {delay(1);}
  89   3           while (IRIN)           //计算IR高电平时长
  90   3            {
  91   4          delay(1);
  92   4          N++;           
  93   4          if (N>=30)
  94   4         { EX0=1;
  95   5         return;}                  //0.14ms计数过长自动离开。
  96   4            }                        //高电平计数完毕                
  97   3           IRCOM[j]=IRCOM[j] << 1;                  //数据最低位补“0”
  98   3           if (N>=8) {IRCOM[j] = IRCOM[j] | 0x01;}  //数据最低位补“1”
  99   3           N=0;
 100   3        }//end for k
 101   2       }//end for j
 102   1      
 103   1        if(IRCOM[0]!=0x80||IRCOM[1]!=0x0f||IRCOM[2]!=0x04)
 104   1        { 
 105   2          IRCOM[3]=0x00;
 106   2          EX0=1;
 107   2          LED2=~LED2;
 108   2          return;
 109   2          } 
 110   1        receive_flag=1;
 111   1         
 112   1      //   if (IRCOM[2]!=~IRCOM[3])
 113   1      //   { EX0=1;
 114   1      //     return; }
 115   1      
 116   1      //   IRCOM[5]=IRCOM[2] & 0x0F;     //取键码的低四位
 117   1      //   IRCOM[6]=IRCOM[2] >> 4;       //右移4次，高四位变为低四位
C51 COMPILER V9.00   DECODING                                                              08/13/2014 15:34:07 PAGE 3   

 118   1      
 119   1      //////////////////////////
 120   1      //  LED=~LED;
 121   1      //L1602_char(2,10,IRCOM[5]);
 122   1      //L1602_char(2,9,IRCOM[6]);
 123   1           //beep();
 124   1      //   IR_val=IRCOM[5]+IRCOM[6]*16;
 125   1           EX0 = 1; 
 126   1      } 
 127          
 128          
 129          /**********************************************************/
 130          void delay(unsigned char x)    //x*0.14MS
 131          {
 132   1        for(;x>0;x--){
 133   2          unsigned char i, j;
 134   2          i = 2;
 135   2          j = 159;
 136   2          do
 137   2          {
 138   3            while (--j);
 139   3          } 
 140   2          while (--i);
 141   2        }
 142   1      }
 143          
 144          /**********************************************************/
 145          void delayms(int ms)
 146          {
 147   1        unsigned char i, j,time;
 148   1        for(time=ms;time>0;time--){
 149   2          i = 12;
 150   2          j = 169;
 151   2          do
 152   2          {
 153   3            while (--j);
 154   3          } while (--i);
 155   2        }
 156   1      }
 157          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    336    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

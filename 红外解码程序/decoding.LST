C51 COMPILER V9.05   DECODING                                                              07/15/2014 20:46:42 PAGE 1   


C51 COMPILER V9.05, COMPILATION OF MODULE DECODING
OBJECT MODULE PLACED IN decoding.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE decoding.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <reg51.h>
   2          #include <intrins.h>
   3          
   4          #define uchar unsigned char
   5          #define uint  unsigned int
   6          
   7          void delay(uchar x);      //x*0.14MS
   8          void delayms(int ms);
   9          
  10          sbit IRIN = P3^2;         //红外接收器数据线
  11          sbit LED1 = P3^5;
  12          sbit LED2 = P3^4;
  13          int IR_val;
  14          
  15          uchar IRCOM[7];
  16          
  17          main()
  18          {
  19   1      //外部中断初始化
  20   1          INT0 = 1;
  21   1          IT0 = 1;                    //设置INT0的中断类型 (1:仅下降沿 0:上升沿和下降沿)
  22   1          EX0 = 1;                    //使能INT0中断
  23   1          EA = 1;
  24   1          
  25   1          IRIN=1;                    //I/O口初始化
  26   1          
  27   1          delayms(10);                //延时
  28   1          while(1)
  29   1          {
  30   2          switch(IR_val)
  31   2            {
  32   3              case 12:
  33   3                LED1=1;
  34   3              break;
  35   3              default:
  36   3                LED1=0;
  37   3              break;
  38   3            }
  39   2          }
  40   1        
  41   1      } //end main
  42          /**********************************************************/
  43          void exint0() interrupt 0      //INT0中断入口
  44          {
  45   1        unsigned char j,k,N=0;
  46   1         EX0 = 0; 
  47   1         delay(15);
  48   1        
  49   1         if (IRIN==1)                         //确认IR信号出现
  50   1           { EX0 =1;
  51   2           return;
  52   2          }
  53   1      
  54   1        while (!IRIN)                        
  55   1        {delay(1);}                          //等IR变为高电平，跳过9ms的前导低电平信号。
C51 COMPILER V9.05   DECODING                                                              07/15/2014 20:46:42 PAGE 2   

  56   1          
  57   1      
  58   1       for (j=0;j<4;j++)         //收集四组数据
  59   1       { 
  60   2        for (k=0;k<8;k++)        //每组数据有8位
  61   2        {
  62   3         while (IRIN)            //等 IR 变为低电平，跳过4.5ms的前导高电平信号。
  63   3           {delay(1);}
  64   3          while (!IRIN)          //等 IR 变为高电平
  65   3           {delay(1);}
  66   3           while (IRIN)           //计算IR高电平时长
  67   3            {
  68   4          delay(1);
  69   4          N++;           
  70   4          if (N>=30)
  71   4         { EX0=1;
  72   5         return;}                  //0.14ms计数过长自动离开。
  73   4            }                        //高电平计数完毕                
  74   3           IRCOM[j]=IRCOM[j] >> 1;                  //数据最高位补“0”
  75   3           if (N>=8) {IRCOM[j] = IRCOM[j] | 0x80;}  //数据最高位补“1”
  76   3           N=0;
  77   3        }//end for k
  78   2       }//end for j
  79   1         
  80   1         if (IRCOM[2]!=~IRCOM[3])
  81   1         { EX0=1;
  82   2           return; }
  83   1      
  84   1         IRCOM[5]=IRCOM[2] & 0x0F;     //取键码的低四位
  85   1         IRCOM[6]=IRCOM[2] >> 4;       //右移4次，高四位变为低四位
  86   1      
  87   1      //////////////////////////
  88   1      //  LED=~LED;
  89   1      //L1602_char(2,10,IRCOM[5]);
  90   1      //L1602_char(2,9,IRCOM[6]);
  91   1           //beep();
  92   1           IR_val=IRCOM[5]+IRCOM[6]*16;
  93   1           EX0 = 1; 
  94   1      } 
  95          
  96          
  97          /**********************************************************/
  98          void delay(unsigned char x)    //x*0.14MS
  99          {
 100   1        for(;x>0;x--){
 101   2          unsigned char i, j;
 102   2          i = 2;
 103   2          j = 159;
 104   2          do
 105   2          {
 106   3            while (--j);
 107   3          } 
 108   2          while (--i);
 109   2        }
 110   1      }
 111          
 112          /**********************************************************/
 113          void delayms(int ms)
 114          {
 115   1        unsigned char i, j,time;
 116   1        for(time=ms;time>0;time--){
 117   2          i = 12;
C51 COMPILER V9.05   DECODING                                                              07/15/2014 20:46:42 PAGE 3   

 118   2          j = 169;
 119   2          do
 120   2          {
 121   3            while (--j);
 122   3          } while (--i);
 123   2        }
 124   1      }
 125          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    298    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
